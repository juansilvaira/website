<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Project 3: Time series analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">HOME</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="projs1and2.html">Projects 1 &amp; 2: Data Wrangling and Principal Component Analysis</a>
</li>
<li>
  <a href="basic_workflow.html">Project 3</a>
</li>
<li>
  <a href="getting_sophisticated.html">Getting Sophisticated</a>
</li>
<li>
  <a href="your_turn.html">Your Turn</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Project 3: Time series analysis</h1>

</div>


<p>
 
</p>
<p><strong>Project 3: Time series data wrangling, exploration and visualization</strong></p>
<p>In this project I will wrangle, explore, and visualize time series data for steelhead salmon passage across the Bonneville Dam (Oregon) from 1940 - 2019. I will present a time series plot with daily data on passage counts, a seasonplot to explore if/how monthly passage has shifted over time, and a visualization of annual steelhead passage counts.</p>
<p>
 
</p>
<img src="images/steel.jpg" width="70%" style="display: block; margin: auto;" />
<center>
<p>Steelhead <em>(Oncorhynchus mykiss)</em>. <em>Photo: United States Department of Agriculture, Forest Service</em></p>
</center>
<p>
 
</p>
<p>
 
</p>
<p>This is the code I used to produce Figure 1:</p>
<pre class="r"><code>fish &lt;- read_csv(&quot;cbr_fish_passage_bonneville_allyrs_steelhead.csv&quot;)

fishdate &lt;-  fish %&gt;% 
  separate(`mm-dd`, into = c(&quot;day&quot;, &quot;month&quot;)) %&gt;% 
  mutate(date = paste(year, month, day, sep = &quot;-&quot;),
         month_sep = paste(year, month, sep = &quot;-&quot;),
         month_sep1= yearmonth(month_sep)) %&gt;% 
  drop_na(value)

fish_gg &lt;- ggplot(data = fishdate, aes(x = month_sep1, y = value)) +
  geom_line() +
  theme_minimal() +
  scale_y_continuous(limits = c(0, 350)) +
    labs (x = &quot;Time (days)&quot;, y = &quot;Count&quot;, title = &quot;Time series of passage counts for Steelhead in Bonneville Dam (1939-2019)&quot;)

fish_gg</code></pre>
<p><img src="proj3_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p><strong>Figure 1</strong>: Time series of passage counts for Steelhead in Bonneville Dam (1939-2019) per day. <em>Source: Columbia River DART, Columbia Basin Research, University of Washington. (2019). Adult Passage Graphics &amp; Text.</em></p>
<p>
 
</p>
<p>Since it seems really difficult to identify any patterns with the data presented by day, I tried a new time series plot, but this time by month.</p>
<p>
 
</p>
<p>This is the code I used to produce Figure 2:</p>
<pre class="r"><code>fishdate2 &lt;- fishdate %&gt;% 
  group_by(month_sep1) %&gt;% 
  summarise(
    sumvalue= sum(value)) 

fish_gg2 &lt;- ggplot(data = fishdate2, aes(x = month_sep1, y = sumvalue)) +
  geom_line() +
  theme_minimal() +
   labs (x = &quot;Time (months)&quot;, y = &quot;Count&quot;, title = &quot;Time series of passage counts for Steelhead in Bonneville Dam (1939-2019)&quot;) + scale_y_continuous(labels = scales::comma)

fish_gg2</code></pre>
<p><img src="proj3_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p><strong>Figure 2</strong>: Time series of passage counts for Steelhead in Bonneville Dam (1939-2019) per month <em>Source: Columbia River DART, Columbia Basin Research, University of Washington. (2019). Adult Passage Graphics &amp; Text.</em></p>
<p>
 
</p>
<p>As observed in Figure 2, there is a very clear annual seasonality, but no clear cyclical trend. Even though there is a massive increase of salmon counts around years 2001 and 2010, it’s not clear that the trend is increasing. In fact, starting in year 2015, there is an important decrease in counts.</p>
<p>
 
</p>
<p>This is the code I used to produce Figure 3:</p>
<pre class="r"><code># Parse the data
fish_parsed &lt;- fishdate2 %&gt;% 
  mutate(month = month(month_sep1, label = TRUE)) %&gt;% 
  mutate(year = year(month_sep1))

### Coerce to a tsibble:

fish_ts &lt;- as_tsibble(fish_parsed, index = month_sep1)


fishplot2 &lt;- ggplot(data = fish_parsed, aes(x = month, y = sumvalue, group = year)) +
  geom_line(aes(color = year)) + 
  theme_minimal() +
   labs (x = &quot;Month&quot;, y = &quot;Count&quot;, title = &quot;Seasonplot of monthly passage of Steelhead in Bonneville Dam (1939-2019)&quot;) + scale_y_continuous(labels = scales::comma)

fishplot2</code></pre>
<p><img src="proj3_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p><strong>Figure 3</strong>: “Seasonplot of monthly passage of Steelhead in Bonneville Dam (1939-2019). <em>Source: Columbia River DART, Columbia Basin Research, University of Washington. (2019). Adult Passage Graphics &amp; Text.</em></p>
<p>
 
</p>
<p>Figure 3 clearly shows that steelhead count peaks in August every year, and that those peaks have been getting larger in the 2000’s.</p>
<p>
 
</p>
<p>This is the code I used to produce Figure 4:</p>
<pre class="r"><code>fishdate3 &lt;- fishdate %&gt;% 
  group_by(year) %&gt;% 
  summarise(
    sumvalue =sum(value)
  )

fish_gg3 &lt;- ggplot(data = fishdate3, aes(x = year, y = sumvalue)) +
  geom_line() +
  theme_minimal() +
  labs (x = &quot;Year&quot;, y = &quot;Count&quot;, title = &quot;Annual Steelhead passage counts in Bonneville Dam (1939-2019)&quot;) + scale_y_continuous(labels = scales::comma)

fish_gg3</code></pre>
<p><img src="proj3_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p><strong>Figure 4</strong>: “Annual Steelhead passage counts in Bonneville Dam (1939-2019). <em>Source: Columbia River DART, Columbia Basin Research, University of Washington. (2019). Adult Passage Graphics &amp; Text.</em></p>
<p>
 
</p>
<p>Figure 4 shows even more clearly the patterns of annual seasonality and relatively sustained increased in counts towards the year 2000-2010, and a decline after year 2015.</p>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
